name: üß© SCA - Analyse des d√©pendances (OWASP Dependency-Check)

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  sca:
    name: Analyse des d√©pendances OWASP
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ R√©cup√©rer le code
      - name: Checkout du code
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Installer Java (n√©cessaire pour OWASP Dependency-Check)
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: "17"
          distribution: "temurin"

      # 3Ô∏è‚É£ T√©l√©charger l'outil Dependency-Check
      - name: Installer OWASP Dependency-Check
        run: |
          echo "üì¶ T√©l√©chargement de OWASP Dependency-Check..."
          wget https://github.com/jeremylong/DependencyCheck/releases/download/v10.0.3/dependency-check-10.0.3-release.zip
          unzip dependency-check-10.0.3-release.zip
          mv dependency-check /opt/dependency-check
          chmod +x /opt/dependency-check/bin/dependency-check.sh

      # 4Ô∏è‚É£ Lancer l'analyse SCA
      - name: Ex√©cuter l'analyse SCA avec OWASP Dependency-Check
        run: |
          echo "üîç Analyse des d√©pendances Maven..."
          /opt/dependency-check/bin/dependency-check.sh \
            --project "DevSecOps-Demo" \
            --scan ./ \
            --format "ALL" \
            --out dependency-report || true

      # 5Ô∏è‚É£ Upload du rapport comme artefact
      - name: Upload du rapport SCA
        uses: actions/upload-artifact@v4
        with:
          name: owasp-dependency-report
          path: dependency-report
