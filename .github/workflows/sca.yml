name: üîç SCA - Analyse des d√©pendances avec Trivy

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  sca:
    name: Analyse des d√©pendances (Trivy)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du code
        uses: actions/checkout@v4

      # ‚úÖ Nouvelle m√©thode d'installation de Trivy (compatible Ubuntu 24.04)
      - name: Installer Trivy (binaire officiel)
        run: |
          echo "üì¶ Installation de Trivy..."
          wget -q https://github.com/aquasecurity/trivy/releases/latest/download/trivy_Linux-64bit.tar.gz
          tar zxvf trivy_Linux-64bit.tar.gz
          sudo mv trivy /usr/local/bin/
          trivy --version

      - name: Lancer l'analyse des d√©pendances avec Trivy
        run: |
          echo "üîç D√©marrage de l'analyse SCA avec Trivy..."
          ./trivy fs --scanners vuln,license . > sca-report.txt || true
          echo "‚úÖ Rapport g√©n√©r√© : sca-report.txt"

      - name: Upload du rapport SCA
        uses: actions/upload-artifact@v4
        with:
          name: sca-report
          path: sca-report.txt
