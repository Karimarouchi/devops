name: üîç SCA - Analyse des d√©pendances avec Trivy

# üî∏ Ce pipeline se lance √† chaque push ou PR sur la branche main
on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  sca:
    name: Analyse des d√©pendances (Trivy)
    runs-on: ubuntu-latest

    steps:
      # √âtape 1 : R√©cup√©rer ton code source
      - name: Checkout du code
        uses: actions/checkout@v4

      # √âtape 2 : Installer Trivy
      - name: Installer Trivy
        run: |
          sudo apt-get update -y
          sudo apt-get install -y wget apt-transport-https gnupg lsb-release
          wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
          echo deb https://aquasecurity.github.io/trivy-repo/deb/ / | sudo tee /etc/apt/sources.list.d/trivy.list
          sudo apt-get update -y
          sudo apt-get install -y trivy

      # √âtape 3 : Scanner ton projet (analyse des d√©pendances)
      - name: Lancer l'analyse des d√©pendances avec Trivy
        run: |
          echo "üîç D√©marrage de l'analyse SCA avec Trivy..."
          trivy fs --scanners vuln,license . > sca-report.txt || true
          echo "‚úÖ Rapport g√©n√©r√© : sca-report.txt"

      # √âtape 4 : Enregistrer le rapport comme artefact
      - name: Upload du rapport SCA
        uses: actions/upload-artifact@v4
        with:
          name: sca-report
          path: sca-report.txt
